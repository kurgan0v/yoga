# Квиз для подбора практик: Детальное описание флоу

## Общая схема работы квиза

1. **Главная страница**
   - Пользователь видит кнопку "Выбрать практику" на главной странице
   - Кнопка является основной точкой входа в квиз
   - На главной также отображается информация о пользователе, его статистика

2. **Шаг 1: Выбор типа практики (Экран "Выбор практики")**
   - Пользователь выбирает один из типов практик:
     - До 7 мин (быстрый выбор)
     - Телесная практика
     - Дыхательная практика
     - Медитация
   - Каждый тип представлен отдельной кнопкой
   - Кнопка "Как это работает?" для получения информации о процессе выбора
   - Кнопка "Назад" для возврата на главную страницу

### Ветка "До 7 мин" (Быстрый выбор)
1. **Выбор цели (короткая практика)**
   - После выбора "До 7 мин" пользователь сразу переходит к выбору цели для короткой практики
   - Цели: "Взбодриться", "Расслабиться / для сна", "Потянуться", "Сфокусироваться"
   - После выбора цели - переход в плеер практики (видео-режим)

### Ветка "Телесная практика"
1. **Выбор времени**
   - Пользователь выбирает предпочитаемую длительность:
     - до 20 минут
     - 20-40 минут
     - 40-60 минут
   - Представлено в виде кнопок выбора
   - Кнопка "Назад" для возврата к выбору типа практики

2. **Выбор цели**
   - Если выбрано "до 20 минут":
     - Цели: "Взбодриться", "Расслабиться / для сна", "Потянуться", "Сфокусироваться"
   - Если выбрано "20-40 минут" или "40-60 минут":
     - Цели: "Ноги", "Все тело", "Плечи", "Кор", "Для ЖКТ", "От боли в спине", "Баланс гормонального фона"
   - После выбора цели - переход в плеер практики (видео-режим)

### Ветка "Дыхательная практика"
1. **Выбор цели**
   - Пользователь выбирает цель для дыхательной практики:
     - "Убрать стресс"
     - "Расслабление и сон"
     - "Поднять энергию/творчество"
     - "Фокус"
     - "Глубина дыхания"
     - "Комплекс"
   - После выбора цели - переход в плеер практики (видео-режим)

### Ветка "Медитация"
1. **Выбор подхода**
   - Пользователь выбирает подход к медитации:
     - "Самостоятельная"
     - "С сопровождением"
   - Представлено в виде двух кнопок выбора

2А. **Самостоятельная медитация - Выбор времени**
   - Выбор длительности медитации с помощью колеса выбора времени
   - Кнопка "Запустить медитацию"
   - После нажатия - выбор объекта для концентрации

3А. **Самостоятельная медитация - Выбор объекта для концентрации**
   - Объекты: "Мысль", "Дыхание", "Тело", "Без объекта"
   - После выбора - переход к таймеру для самостоятельной медитации

2Б. **Медитация с сопровождением - Выбор темы**
   - Выбор темы для медитации
   - После выбора темы - переход к выбору цели

3Б. **Медитация с сопровождением - Выбор цели**
   - Цели: "Тело", "Мышление", "Отношения"
   - После выбора цели - переход в плеер медитации (аудио-режим)

## Режимы плеера

1. **Видео-плеер (для телесных и дыхательных практик)**
   - Отображение видео с практикой
   - Название упражнения
   - Длительность
   - Описание
   - Элементы управления воспроизведением
   - Кнопка "Другая практика" для выбора другой практики

2. **Аудио-плеер (для медитаций с сопровождением)**
   - Название медитации
   - Описание
   - Прогресс-бар
   - Элементы управления воспроизведением
   - Кнопка "Другая медитация" для выбора другой медитации

3. **Таймер для самостоятельной медитации**
   - Инструкции (например, "Закройте глаза и сфокусируйтесь на себе")
   - Таймер обратного отсчета
   - Кнопка "Остановиться" для завершения практики

## Логика работы с Supabase

1. **Запрос данных**
   - При инициализации квиза загружаются все доступные опции из таблицы quizlogic
   - На каждом шаге квиза фильтруются доступные опции для следующего шага
   - После последнего шага выполняется запрос для получения подходящей практики RANDOM но с учетом уже рекомендованных - надо учесть в супе как то. Если рекомендованные уже все,список сбрасывается. 

2. **Фильтрация результатов**
   - Последовательная фильтрация происходит по выбранным параметрам в зависимости от ветки:
     - Тип практики (`type`)
     - Длительность (`duration`) если применимо
     - Цель (`goal`)
     - Подход (`approach`) для медитации
   - Если подходящих практик несколько, выбирается случайная из них
   - Если нет точного совпадения, находится ближайшая по параметрам практика

## Хранение состояния

1. **Состояние квиза**
   - Все выбранные пользователем параметры хранятся в React контексте (QuizContext)
   - При навигации "Назад" восстанавливаются ранее выбранные значения
   - Состояние сохраняется при перезагрузке страницы через localStorage

2. **Состояние плеера**
   - Текущий прогресс воспроизведения и настройки хранятся в PlayerContext
   - При переключении между режимами сохраняется общее состояние (громкость и т.д.)

## Описание режимов плеера

1. **Медитационный режим**
   - Визуализация времени в виде круговой анимации
   - Фоновое аудио с возможностью регулировки громкости
   - Уведомление о завершении практики

2. **Видео режим**
   - Воспроизведение видео с инструкциями по практике
   - Стандартные элементы управления видео
   - Возможность полноэкранного просмотра
   - Отображение текстовой информации рядом с видео

## Зависимости между выборами

- Выбор типа практики определяет доступные опции цели
- Выбор подхода к практике влияет на тип контента (видео для guided, таймер для self-practice)
- Длительность практики влияет на доступные практики для выбора 