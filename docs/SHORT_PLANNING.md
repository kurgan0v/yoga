# –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

## –õ–æ–≥–∏—á–µ—Å–∫–∏–µ –æ—Å–Ω–æ–≤–∞–Ω–∏—è
- **–í–µ—â—å**: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –π–æ–≥–∏/–º–µ–¥–∏—Ç–∞—Ü–∏–π —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Telegram –∏ Supabase
- **–°–≤–æ–π—Å—Ç–≤–∞**: –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è, realtime, –∫–∞–ª–µ–Ω–¥–∞—Ä—å —Å–æ–±—ã—Ç–∏–π
- **–û—Ç–Ω–æ—à–µ–Ω–∏—è**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üî –ö–æ–Ω—Ç–µ–Ω—Ç, –°–æ–±—ã—Ç–∏—è ‚Üî –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –ö–æ–Ω—Ç–µ–Ω—Ç ‚Üî –ö–∞—Ç–µ–≥–æ—Ä–∏–∏

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –Ω–∞ —Ç–µ–∫—É—â—É—é –∏—Ç–µ—Ä–∞—Ü–∏—é

1. ‚úÖ **–ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–∞–ª–µ–Ω–¥–∞—Ä—è**
   - –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É events –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
   - –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç CalendarPage
   - –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Supabase

2. ‚úÖ **–ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –±–∏–±–ª–∏–æ—Ç–µ–∫–∏**
   - –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –æ—à–∏–±–∫–∏
   - –£–ª—É—á—à–∏—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º

3. ‚úÖ **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é –∏ UX**
   - –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "–î—ã—Ö–∞–Ω–∏–µ" –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ
   - –†–µ–¥–∏–∑–∞–π–Ω –Ω–∏–∂–Ω–µ–≥–æ –º–µ–Ω—é (TabBar) - —É–≤–µ–ª–∏—á–∏—Ç—å –∏–∫–æ–Ω–∫–∏, —É–ª—É—á—à–∏—Ç—å —á–∏—Ç–∞–µ–º–æ—Å—Ç—å
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ç–µ–ª–µ–≥—Ä–∞–º–æ–≤—Å–∫–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –≤–æ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö

4. üü° **–î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å**
   - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π
   - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π

5. üü° **–£–ª—É—á—à–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—É—é –ø–∞–Ω–µ–ª—å**
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è–º–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
   - –£–ø—Ä–æ—â–µ–Ω–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

## –ß–µ–∫-–ª–∏—Å—Ç –∫–∞—á–µ—Å—Ç–≤–∞

- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ—à–∏–±–∫–∏ –∫–æ–Ω—Å–æ–ª–∏
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Supabase
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã realtime –∫–∞–Ω–∞–ª–æ–≤
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ Telegram Mini App
- [x] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–º–µ—Ç–∫–∏

- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞
- –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –í–Ω–µ–¥—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

# Short Term Plan: Refactor Kinescope Player Logic

## Goal:
Replicate the working Kinescope player logic from the Admin panel to the main client-side PlayerContext and PlayerWidget to fix lagging and ensure videos play correctly. Audio and Timer practices should remain unaffected.

## Checklist & Steps:

### 1. Initial Setup & Investigation:
    - [X] Create/Verify `docs/TASK.md` and `docs/SHORT_PLANNING.md`. (AI - July 26, 2024)
    - [ ] Read `AdminPage` to understand current Kinescope implementation (`handleVideoPreview`).
    - [ ] Read `PlayerContext` and the main `PlayerWidget` (`Player.tsx` likely in `src/components/Player/`) to understand current player logic.
    - [ ] Read `PracticePage` to understand how it uses the player and identify potential causes for lagging.
    - [ ] Check if admin uses an iframe for Kinescope. If so, plan to replace with `@kinescope/react-vite`.

### 2. Implementation:
    - [ ] Update `PlayerContext`:
        - Add state/logic to manage Kinescope player instance and video ID.
        - Modify functions to play Kinescope videos when `contentType` is video and `kinescope_id` is present.
    - [ ] Update `PlayerWidget`:
        - Conditionally render the Kinescope player (e.g., using `@kinescope/react-vite`) when a Kinescope video is active.
        - Ensure existing audio/timer player logic remains functional.
    - [ ] Refactor `PracticePage`:
        - Ensure it correctly passes practice data to `PlayerContext`.
        - Optimize rendering to prevent lags if identified.

### 3. Cleanup & Verification:
    - [ ] Remove `getKinescopeVideoMetadata` from `@/lib/kinescopeService.ts`.
    - [ ] Test Kinescope video playback on `PracticePage`.
    - [ ] Test audio playback on `PracticePage`.
    - [ ] Test timer/meditation on `PracticePage`.
    - [ ] Test Kinescope video playback in Admin Panel (ensure it still works or is improved).
    - [ ] Verify no new linter errors or build issues.

### 4. Documentation & Git:
    - [ ] Update `architecture.md` if any significant changes to player logic or new libraries are introduced.
    - [ ] Update `TASK.md` with progress.
    - [ ] Commit changes with a descriptive message.

## Key Files to Examine/Modify:
- `src/pages/AdminPage/AdminPage.tsx` (or similar)
- `src/contexts/PlayerContext.tsx` (or similar)
- `src/components/Player/Player.tsx` (or similar)
- `src/pages/PracticePage/PracticePage.tsx` (or similar)
- `src/lib/kinescopeService.ts`
- `package.json` (if Kinescope library needs to be added/updated)

## Potential Challenges:
- Integrating Kinescope player library (`@kinescope/react-vite` or `@kinescope/react`) correctly with Vite.
- Managing different player states (Kinescope, audio, timer) within a single context/widget.
- Resolving performance issues on `PracticePage`.